{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/home/mohammad/projects/dorreh/market multi/client/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/home/mohammad/projects/dorreh/market multi/client/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/home/mohammad/projects/dorreh/market multi/client/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"/home/mohammad/projects/dorreh/market multi/client/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/home/mohammad/projects/dorreh/market multi/client/src/layout/CI/Layout/components/chat/PrivateChat/PrivateChat.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { ReactComponent as ArrowDown } from \"assets/images/icons/Arrows/Big/Down.svg\";\nimport { ReactComponent as ArrowUp } from \"assets/images/icons/Arrows/Big/up.svg\";\nimport { ReactComponent as CloseSvg } from \"assets/images/icons/UI/Close.svg\";\nimport { ReactComponent as ImageIcon } from \"assets/images/icons/Content/Image.svg\";\nimport { ReactComponent as AttachIcon } from \"assets/images/icons/Content/Attachment.svg\";\nimport GolButton from \"components/GolButton\";\nimport GolTextField from \"components/GolTextField\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useIntl } from \"react-intl\";\nimport { usePrivateChatStyle } from \"./usePrivateChatStyle\";\nimport MessangerMessages from \"../Messanger.message\";\n\nvar PrivateChat = function PrivateChat(_ref) {\n  _s();\n\n  var _selectedContact$cust2, _selectedContact$cust3, _selectedContact$cust4, _selectedContact$cust5;\n\n  var selectedContact = _ref.selectedContact,\n      setPrivate = _ref.setPrivate,\n      messages = _ref.messages,\n      setMessages = _ref.setMessages,\n      socket = _ref.socket,\n      loading = _ref.loading;\n  var styles = usePrivateChatStyle();\n\n  var _useIntl = useIntl(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState = useState(true),\n      open = _useState[0],\n      setOpen = _useState[1];\n\n  var _useState2 = useState(null),\n      message = _useState2[0],\n      setMessage = _useState2[1];\n\n  var _useState3 = useState(0),\n      unreadedMessages = _useState3[0],\n      setUnreadedMessages = _useState3[1];\n\n  var _useState4 = useState(selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id),\n      orderId = _useState4[0],\n      setOrderId = _useState4[1];\n\n  var msgRef = useRef(null);\n\n  var sendMessage = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var _localStorage, _selectedContact$cust, chatMessage;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (message) {\n                e.preventDefault();\n                chatMessage = {\n                  fromUser: (_localStorage = localStorage) === null || _localStorage === void 0 ? void 0 : _localStorage.userId,\n                  toUser: selectedContact === null || selectedContact === void 0 ? void 0 : (_selectedContact$cust = selectedContact.customer) === null || _selectedContact$cust === void 0 ? void 0 : _selectedContact$cust._id,\n                  body: message,\n                  order: orderId,\n                  type: \"text\"\n                };\n                socket.emit(\"sendMessage\", chatMessage);\n\n                if (messages !== null && messages !== void 0 && messages.length) {\n                  setMessages(function (prev) {\n                    return [].concat(_toConsumableArray(prev), [_objectSpread(_objectSpread({}, chatMessage), {}, {\n                      dateTime: new Date()\n                    })]);\n                  });\n                } else {\n                  setMessage([_objectSpread(_objectSpread({}, chatMessage), {}, {\n                    dateTime: new Date()\n                  })]);\n                }\n\n                setMessage(\"\");\n              }\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function sendMessage(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var _messages;\n\n    var scroll = msgRef.current.scrollHeight - msgRef.current.clientHeight;\n\n    if (messages && (_messages = messages[messages.length - 1]) !== null && _messages !== void 0 && _messages.fromUser) {\n      console.log(\"scrollHeight: \", msgRef.current.scrollHeight);\n      console.log(\"scrollTop: \", msgRef.current.scrollTop);\n      console.log(msgRef.current.scrollHeight - msgRef.current.scrollTop);\n\n      if (msgRef.current.scrollTop && msgRef.current.scrollHeight - msgRef.current.scrollTop > 505) {\n        setUnreadedMessages(function (prev) {\n          return prev += 1;\n        });\n      } else {\n        msgRef.current.scrollTo(0, scroll);\n      }\n    } else {\n      msgRef.current.scrollTo(0, scroll);\n    }\n  }, [messages]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.root,\n    style: open ? {\n      bottom: 0\n    } : {\n      bottom: -519\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.header,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"\".concat(selectedContact !== null && selectedContact !== void 0 && (_selectedContact$cust2 = selectedContact.customer) !== null && _selectedContact$cust2 !== void 0 && _selectedContact$cust2.firstName ? selectedContact === null || selectedContact === void 0 ? void 0 : (_selectedContact$cust3 = selectedContact.customer) === null || _selectedContact$cust3 === void 0 ? void 0 : _selectedContact$cust3.firstName : \"No Name\", \" \").concat(selectedContact !== null && selectedContact !== void 0 && (_selectedContact$cust4 = selectedContact.customer) !== null && _selectedContact$cust4 !== void 0 && _selectedContact$cust4.lastName ? selectedContact === null || selectedContact === void 0 ? void 0 : (_selectedContact$cust5 = selectedContact.customer) === null || _selectedContact$cust5 === void 0 ? void 0 : _selectedContact$cust5.lastName : \"\")\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.spaceBetween,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.toggle,\n          onClick: function onClick() {\n            return setOpen(!open);\n          },\n          children: open ? /*#__PURE__*/_jsxDEV(ArrowDown, {\n            className: styles.sendSvg\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 15\n          }, _this) : /*#__PURE__*/_jsxDEV(ArrowUp, {\n            className: styles.sendSvg\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            cursor: \"pointer\"\n          },\n          children: /*#__PURE__*/_jsxDEV(CloseSvg, {\n            onClick: function onClick() {\n              return setPrivate(false);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.body,\n      ref: msgRef,\n      children: selectedContact ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: !loading ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: messages !== null && messages !== void 0 && messages.length ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: messages === null || messages === void 0 ? void 0 : messages.map(function (item) {\n              var _item$fromUser, _localStorage2, _localStorage3, _item$fromUser2, _localStorage4, _localStorage5;\n\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.message,\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: (item === null || item === void 0 ? void 0 : (_item$fromUser = item.fromUser) === null || _item$fromUser === void 0 ? void 0 : _item$fromUser._id) === ((_localStorage2 = localStorage) === null || _localStorage2 === void 0 ? void 0 : _localStorage2.userId) || (item === null || item === void 0 ? void 0 : item.fromUser) === ((_localStorage3 = localStorage) === null || _localStorage3 === void 0 ? void 0 : _localStorage3.userId) ? styles.spaceBetweenMe : styles.spaceBetween,\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.avatar\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 123,\n                    columnNumber: 27\n                  }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: styles.date,\n                    children: new Date(item === null || item === void 0 ? void 0 : item.dateTime).toLocaleTimeString()\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 124,\n                    columnNumber: 27\n                  }, _this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 115,\n                  columnNumber: 25\n                }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: (item === null || item === void 0 ? void 0 : (_item$fromUser2 = item.fromUser) === null || _item$fromUser2 === void 0 ? void 0 : _item$fromUser2._id) === ((_localStorage4 = localStorage) === null || _localStorage4 === void 0 ? void 0 : _localStorage4.userId) || (item === null || item === void 0 ? void 0 : item.fromUser) === ((_localStorage5 = localStorage) === null || _localStorage5 === void 0 ? void 0 : _localStorage5.userId) ? styles.bottomMe : styles.bottom,\n                  children: item === null || item === void 0 ? void 0 : item.body\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 128,\n                  columnNumber: 25\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 114,\n                columnNumber: 23\n              }, _this);\n            })\n          }, void 0, false) : \"No Messages\"\n        }, void 0, false) : \"loading...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }, _this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: formatMessage(MessangerMessages.noMessage)\n      }, void 0, false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.sendMessage,\n      children: [unreadedMessages ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.unReadedMessages,\n        onClick: function onClick() {\n          var scroll = msgRef.current.scrollHeight - msgRef.current.clientHeight;\n          msgRef.current.scrollTo(0, scroll);\n          setUnreadedMessages(0);\n        },\n        children: unreadedMessages\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }, _this) : null, /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: sendMessage,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.sendMessageInput,\n          children: /*#__PURE__*/_jsxDEV(GolTextField, {\n            value: message,\n            onChange: function onChange(e) {\n              return setMessage(e.target.value);\n            },\n            className: styles.searchInput,\n            placeholder: formatMessage(MessangerMessages.writeMessage)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.sendMessageTools,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: styles.attachIcon,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(AttachIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 180,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(ImageIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 183,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 15\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 13\n          }, _this), /*#__PURE__*/_jsxDEV(GolButton, {\n            type: \"submit\",\n            color: \"primary\",\n            variant: \"contained\",\n            children: formatMessage(MessangerMessages.send)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(PrivateChat, \"0ec7EBJ9GbLIBLQyN/DH5s1LAuI=\", false, function () {\n  return [usePrivateChatStyle, useIntl];\n});\n\n_c = PrivateChat;\nexport default PrivateChat;\n\nvar _c;\n\n$RefreshReg$(_c, \"PrivateChat\");","map":{"version":3,"sources":["/home/mohammad/projects/dorreh/market multi/client/src/layout/CI/Layout/components/chat/PrivateChat/PrivateChat.tsx"],"names":["ReactComponent","ArrowDown","ArrowUp","CloseSvg","ImageIcon","AttachIcon","GolButton","GolTextField","React","useEffect","useRef","useState","useIntl","usePrivateChatStyle","MessangerMessages","PrivateChat","selectedContact","setPrivate","messages","setMessages","socket","loading","styles","formatMessage","open","setOpen","message","setMessage","unreadedMessages","setUnreadedMessages","_id","orderId","setOrderId","msgRef","sendMessage","e","preventDefault","chatMessage","fromUser","localStorage","userId","toUser","customer","body","order","type","emit","length","prev","dateTime","Date","scroll","current","scrollHeight","clientHeight","console","log","scrollTop","scrollTo","root","bottom","header","firstName","lastName","spaceBetween","toggle","sendSvg","cursor","map","item","spaceBetweenMe","avatar","date","toLocaleTimeString","bottomMe","noMessage","unReadedMessages","sendMessageInput","target","value","searchInput","writeMessage","sendMessageTools","attachIcon","send"],"mappings":"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","sourcesContent":["import { ReactComponent as ArrowDown } from \"assets/images/icons/Arrows/Big/Down.svg\";\nimport { ReactComponent as ArrowUp } from \"assets/images/icons/Arrows/Big/up.svg\";\nimport { ReactComponent as CloseSvg } from \"assets/images/icons/UI/Close.svg\";\nimport { ReactComponent as ImageIcon } from \"assets/images/icons/Content/Image.svg\";\nimport { ReactComponent as AttachIcon } from \"assets/images/icons/Content/Attachment.svg\";\nimport GolButton from \"components/GolButton\";\nimport GolTextField from \"components/GolTextField\";\nimport { useSession } from \"next-auth/client\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useIntl } from \"react-intl\";\nimport { usePrivateChatStyle } from \"./usePrivateChatStyle\";\nimport MessangerMessages from \"../Messanger.message\";\n\nconst PrivateChat = ({\n  selectedContact,\n  setPrivate,\n  messages,\n  setMessages,\n  socket,\n  loading,\n}) => {\n  const styles = usePrivateChatStyle();\n  const { formatMessage } = useIntl();\n  const [open, setOpen] = useState(true);\n  const [message, setMessage] = useState(null);\n  const [unreadedMessages, setUnreadedMessages] = useState(0);\n  const [orderId, setOrderId] = useState(selectedContact?._id);\n\n  const msgRef = useRef(null);\n\n  const sendMessage = async (e) => {\n    if (message) {\n      e.preventDefault();\n\n      const chatMessage = {\n        fromUser: localStorage?.userId,\n        toUser: selectedContact?.customer?._id,\n        body: message,\n        order: orderId,\n        type: \"text\",\n      };\n\n      socket.emit(\"sendMessage\", chatMessage);\n\n      if (messages?.length) {\n        setMessages((prev) => [\n          ...prev,\n          { ...chatMessage, dateTime: new Date() },\n        ]);\n      } else {\n        setMessage([{ ...chatMessage, dateTime: new Date() }]);\n      }\n\n      setMessage(\"\");\n    }\n  };\n\n  useEffect(() => {\n    const scroll = msgRef.current.scrollHeight - msgRef.current.clientHeight;\n    if (messages && messages[messages.length - 1]?.fromUser) {\n      console.log(\"scrollHeight: \", msgRef.current.scrollHeight);\n      console.log(\"scrollTop: \", msgRef.current.scrollTop);\n      console.log(msgRef.current.scrollHeight - msgRef.current.scrollTop);\n      if (\n        msgRef.current.scrollTop &&\n        msgRef.current.scrollHeight - msgRef.current.scrollTop > 505\n      ) {\n        setUnreadedMessages((prev) => (prev += 1));\n      } else {\n        msgRef.current.scrollTo(0, scroll);\n      }\n    } else {\n      msgRef.current.scrollTo(0, scroll);\n    }\n  }, [messages]);\n\n  return (\n    <div\n      className={styles.root}\n      style={open ? { bottom: 0 } : { bottom: -519 }}\n    >\n      <div className={styles.header}>\n        <div>{`${\n          selectedContact?.customer?.firstName\n            ? selectedContact?.customer?.firstName\n            : \"No Name\"\n        } ${\n          selectedContact?.customer?.lastName\n            ? selectedContact?.customer?.lastName\n            : \"\"\n        }`}</div>\n        <div className={styles.spaceBetween}>\n          <div className={styles.toggle} onClick={() => setOpen(!open)}>\n            {open ? (\n              <ArrowDown className={styles.sendSvg} />\n            ) : (\n              <ArrowUp className={styles.sendSvg} />\n            )}\n          </div>\n          <div style={{ cursor: \"pointer\" }}>\n            <CloseSvg onClick={() => setPrivate(false)} />\n          </div>\n        </div>\n      </div>\n\n      <div className={styles.body} ref={msgRef}>\n        {selectedContact ? (\n          <div>\n            {!loading ? (\n              <>\n                {messages?.length ? (\n                  <>\n                    {messages?.map((item) => (\n                      <div className={styles.message}>\n                        <div\n                          className={\n                            item?.fromUser?._id === localStorage?.userId ||\n                            item?.fromUser === localStorage?.userId\n                              ? styles.spaceBetweenMe\n                              : styles.spaceBetween\n                          }\n                        >\n                          <div className={styles.avatar}></div>\n                          <div className={styles.date}>\n                            {new Date(item?.dateTime).toLocaleTimeString()}\n                          </div>\n                        </div>\n                        <div\n                          className={\n                            item?.fromUser?._id === localStorage?.userId ||\n                            item?.fromUser === localStorage?.userId\n                              ? styles.bottomMe\n                              : styles.bottom\n                          }\n                        >\n                          {item?.body}\n                        </div>\n                      </div>\n                    ))}\n                  </>\n                ) : (\n                  \"No Messages\"\n                )}\n              </>\n            ) : (\n              \"loading...\"\n            )}\n          </div>\n        ) : (\n          <>{formatMessage(MessangerMessages.noMessage)}</>\n        )}\n      </div>\n\n      <div className={styles.sendMessage}>\n        {unreadedMessages ? (\n          <div\n            className={styles.unReadedMessages}\n            onClick={() => {\n              const scroll =\n                msgRef.current.scrollHeight - msgRef.current.clientHeight;\n              msgRef.current.scrollTo(0, scroll);\n              setUnreadedMessages(0);\n            }}\n          >\n            {unreadedMessages}\n          </div>\n        ) : null}\n        <form onSubmit={sendMessage}>\n          <div className={styles.sendMessageInput}>\n            <GolTextField\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              className={styles.searchInput}\n              placeholder={formatMessage(MessangerMessages.writeMessage)}\n            />\n          </div>\n          <div className={styles.sendMessageTools}>\n            <div className={styles.attachIcon}>\n              <div>\n                <AttachIcon />\n              </div>\n              <div>\n                <ImageIcon />\n              </div>\n            </div>\n            <GolButton type=\"submit\" color=\"primary\" variant=\"contained\">\n              {formatMessage(MessangerMessages.send)}\n            </GolButton>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default PrivateChat;\n"]},"metadata":{},"sourceType":"module"}