{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { ReactComponent as ArrowDown } from \"assets/images/icons/Arrows/Big/Down.svg\";\nimport { ReactComponent as ArrowUp } from \"assets/images/icons/Arrows/Big/up.svg\";\nimport { ReactComponent as CloseSvg } from \"assets/images/icons/UI/Close.svg\";\nimport { ReactComponent as ImageIcon } from \"assets/images/icons/Content/Image.svg\";\nimport { ReactComponent as AttachIcon } from \"assets/images/icons/Content/Attachment.svg\";\nimport GolButton from \"components/GolButton\";\nimport GolTextField from \"components/GolTextField\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useIntl } from \"react-intl\";\nimport { usePrivateChatStyle } from \"./usePrivateChatStyle\";\nimport MessangerMessages from \"../Messanger.message\";\n\nconst PrivateChat = ({\n  selectedContact,\n  setPrivate,\n  messages,\n  setMessages,\n  socket,\n  loading\n}) => {\n  var _selectedContact$cust2, _selectedContact$cust3, _selectedContact$cust4, _selectedContact$cust5;\n\n  const styles = usePrivateChatStyle();\n  const {\n    formatMessage\n  } = useIntl();\n  const {\n    0: open,\n    1: setOpen\n  } = useState(true);\n  const {\n    0: message,\n    1: setMessage\n  } = useState(\"\");\n  const {\n    0: unreadedMessages,\n    1: setUnreadedMessages\n  } = useState(0);\n  const {\n    0: orderId,\n    1: setOrderId\n  } = useState(selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id);\n  const msgRef = useRef(null);\n\n  const sendMessage = async e => {\n    var _localStorage, _selectedContact$cust;\n\n    e.preventDefault();\n    const chatMessage = {\n      fromUser: (_localStorage = localStorage) === null || _localStorage === void 0 ? void 0 : _localStorage.userId,\n      toUser: selectedContact === null || selectedContact === void 0 ? void 0 : (_selectedContact$cust = selectedContact.customer) === null || _selectedContact$cust === void 0 ? void 0 : _selectedContact$cust._id,\n      body: message,\n      order: orderId,\n      type: \"text\"\n    };\n    socket.emit(\"sendMessage\", chatMessage);\n    setMessages(prev => [...prev, _objectSpread(_objectSpread({}, chatMessage), {}, {\n      dateTime: new Date()\n    })]);\n    setMessage(\"\");\n  };\n\n  useEffect(() => {\n    var _messages;\n\n    const scroll = msgRef.current.scrollHeight - msgRef.current.clientHeight;\n\n    if (messages && (_messages = messages[messages.length - 1]) !== null && _messages !== void 0 && _messages.fromUser) {\n      console.log(\"scrollHeight: \", msgRef.current.scrollHeight);\n      console.log(\"scrollTop: \", msgRef.current.scrollTop);\n      console.log(msgRef.current.scrollHeight - msgRef.current.scrollTop);\n\n      if (msgRef.current.scrollTop && msgRef.current.scrollHeight - msgRef.current.scrollTop > 505) {\n        setUnreadedMessages(prev => prev += 1);\n      } else {\n        msgRef.current.scrollTo(0, scroll);\n      }\n    } else {\n      msgRef.current.scrollTo(0, scroll);\n    }\n  }, [messages]);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: styles.root,\n    style: open ? {\n      bottom: 0\n    } : {\n      bottom: -519\n    },\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: styles.header,\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        children: `${selectedContact !== null && selectedContact !== void 0 && (_selectedContact$cust2 = selectedContact.customer) !== null && _selectedContact$cust2 !== void 0 && _selectedContact$cust2.firstName ? selectedContact === null || selectedContact === void 0 ? void 0 : (_selectedContact$cust3 = selectedContact.customer) === null || _selectedContact$cust3 === void 0 ? void 0 : _selectedContact$cust3.firstName : \"No Name\"} ${selectedContact !== null && selectedContact !== void 0 && (_selectedContact$cust4 = selectedContact.customer) !== null && _selectedContact$cust4 !== void 0 && _selectedContact$cust4.lastName ? selectedContact === null || selectedContact === void 0 ? void 0 : (_selectedContact$cust5 = selectedContact.customer) === null || _selectedContact$cust5 === void 0 ? void 0 : _selectedContact$cust5.lastName : \"\"}`\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: styles.spaceBetween,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: styles.toggle,\n          onClick: () => setOpen(!open),\n          children: open ? /*#__PURE__*/_jsx(ArrowDown, {\n            className: styles.sendSvg\n          }) : /*#__PURE__*/_jsx(ArrowUp, {\n            className: styles.sendSvg\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          style: {\n            cursor: \"pointer\"\n          },\n          children: /*#__PURE__*/_jsx(CloseSvg, {\n            onClick: () => setPrivate(false)\n          })\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: styles.body,\n      ref: msgRef,\n      children: selectedContact ? /*#__PURE__*/_jsx(\"div\", {\n        children: !loading ? /*#__PURE__*/_jsx(_Fragment, {\n          children: messages !== null && messages !== void 0 && messages.length ? /*#__PURE__*/_jsx(_Fragment, {\n            children: messages === null || messages === void 0 ? void 0 : messages.map(item => {\n              var _item$fromUser, _localStorage2, _localStorage3, _item$fromUser2, _localStorage4, _localStorage5;\n\n              return /*#__PURE__*/_jsxs(\"div\", {\n                className: styles.message,\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: (item === null || item === void 0 ? void 0 : (_item$fromUser = item.fromUser) === null || _item$fromUser === void 0 ? void 0 : _item$fromUser._id) === ((_localStorage2 = localStorage) === null || _localStorage2 === void 0 ? void 0 : _localStorage2.userId) || (item === null || item === void 0 ? void 0 : item.fromUser) === ((_localStorage3 = localStorage) === null || _localStorage3 === void 0 ? void 0 : _localStorage3.userId) ? styles.spaceBetweenMe : styles.spaceBetween,\n                  children: [/*#__PURE__*/_jsx(\"div\", {\n                    className: styles.avatar\n                  }), /*#__PURE__*/_jsx(\"div\", {\n                    className: styles.date,\n                    children: new Date(item === null || item === void 0 ? void 0 : item.dateTime).toLocaleTimeString()\n                  })]\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: (item === null || item === void 0 ? void 0 : (_item$fromUser2 = item.fromUser) === null || _item$fromUser2 === void 0 ? void 0 : _item$fromUser2._id) === ((_localStorage4 = localStorage) === null || _localStorage4 === void 0 ? void 0 : _localStorage4.userId) || (item === null || item === void 0 ? void 0 : item.fromUser) === ((_localStorage5 = localStorage) === null || _localStorage5 === void 0 ? void 0 : _localStorage5.userId) ? styles.bottomMe : styles.bottom,\n                  children: item === null || item === void 0 ? void 0 : item.body\n                })]\n              });\n            })\n          }) : \"No Messages\"\n        }) : \"loading...\"\n      }) : /*#__PURE__*/_jsx(_Fragment, {\n        children: formatMessage(MessangerMessages.noMessage)\n      })\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.sendMessage,\n      children: [unreadedMessages ? /*#__PURE__*/_jsx(\"div\", {\n        className: styles.unReadedMessages,\n        onClick: () => {\n          const scroll = msgRef.current.scrollHeight - msgRef.current.clientHeight;\n          msgRef.current.scrollTo(0, scroll);\n          setUnreadedMessages(0);\n        },\n        children: unreadedMessages\n      }) : null, /*#__PURE__*/_jsxs(\"form\", {\n        onSubmit: sendMessage,\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: styles.sendMessageInput,\n          children: /*#__PURE__*/_jsx(GolTextField, {\n            value: message,\n            onChange: e => setMessage(e.target.value),\n            className: styles.searchInput,\n            placeholder: formatMessage(MessangerMessages.writeMessage)\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.sendMessageTools,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: styles.attachIcon,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsx(AttachIcon, {})\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: /*#__PURE__*/_jsx(ImageIcon, {})\n            })]\n          }), /*#__PURE__*/_jsx(GolButton, {\n            type: \"submit\",\n            color: \"primary\",\n            variant: \"contained\",\n            children: formatMessage(MessangerMessages.send)\n          })]\n        })]\n      })]\n    })]\n  });\n};\n\nexport default PrivateChat;","map":null,"metadata":{},"sourceType":"module"}