{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _defineProperty from \"/home/mohammad/projects/dorreh/market multi/client/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"/home/mohammad/projects/dorreh/market multi/client/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { ReactComponent as ArrowDown } from \"assets/images/icons/Arrows/Big/Down.svg\";\nimport { ReactComponent as ArrowUp } from \"assets/images/icons/Arrows/Big/up.svg\";\nimport { ReactComponent as SendSvg } from \"assets/images/icons/Commiunication/Send.svg\";\nimport { ReactComponent as SearchSvg } from \"assets/images/icons/UI/Search.svg\";\nimport GolTextField from \"components/GolTextField\";\nimport React, { useState, useEffect } from \"react\";\nimport { useIntl } from \"react-intl\";\nimport MessangerMessages from \"./Messanger.message\";\nimport PrivateChat from \"./PrivateChat\";\nimport { useMessangerStyle } from \"./useMessangerStyle\";\nimport { socket } from \"utils/socket\";\nimport axios from \"axios\";\nimport { api } from \"domains/api\";\n\nvar Messanger = function Messanger(_ref) {\n  var openChat = _ref.openChat,\n      setOpenChat = _ref.setOpenChat;\n  var styles = useMessangerStyle();\n\n  var _useIntl = useIntl(),\n      formatMessage = _useIntl.formatMessage;\n\n  var _useState = useState(false),\n      privateMessage = _useState[0],\n      setPrivate = _useState[1];\n\n  var _useState2 = useState(null),\n      selectedContact = _useState2[0],\n      setSelectedContact = _useState2[1];\n\n  var _useState3 = useState(null),\n      messages = _useState3[0],\n      setMessages = _useState3[1];\n\n  var _useState4 = useState(true),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useState5 = useState([]),\n      orders = _useState5[0],\n      setOrders = _useState5[1];\n\n  var _useState6 = useState([]),\n      counter = _useState6[0],\n      setCounter = _useState6[1];\n\n  useEffect(function () {\n    var _localStorage;\n\n    axios.get(\"\".concat(api, \"/api/order\"), {\n      headers: {\n        \"x-auth-token\": (_localStorage = localStorage) === null || _localStorage === void 0 ? void 0 : _localStorage.token\n      }\n    }).then(function (res) {\n      return setOrders(res === null || res === void 0 ? void 0 : res.data);\n    })[\"catch\"](function (err) {\n      return console.log(err);\n    });\n  }, []);\n  useEffect(function () {\n    if (selectedContact !== null && selectedContact !== void 0 && selectedContact._id) {\n      var _localStorage2;\n\n      setLoading(true);\n      socket.emit(\"join\", {\n        order: selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id\n      });\n      axios.get(\"\".concat(api, \"/api/messages/\").concat(selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id), {\n        headers: {\n          \"x-auth-token\": (_localStorage2 = localStorage) === null || _localStorage2 === void 0 ? void 0 : _localStorage2.token\n        }\n      }).then(function (res) {\n        var _res$data;\n\n        setLoading(false);\n        setMessages(res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.messages);\n      })[\"catch\"](function (err) {\n        return console.log(err);\n      });\n    }\n  }, [selectedContact]);\n  useEffect(function () {\n    socket.on(\"receiveMessage\", function (data) {\n      console.log(\"selectedContact, data ~ selectedContact, data\", selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id, data === null || data === void 0 ? void 0 : data.order);\n\n      if ((selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id) == (data === null || data === void 0 ? void 0 : data.order)) {\n        setMessages(function (prev) {\n          return [].concat(_toConsumableArray(prev), [data]);\n        });\n      }\n    });\n    socket.on(\"newConversation\", function (data) {\n      if ((selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id) !== (data === null || data === void 0 ? void 0 : data.order)) {\n        setCounter(function (prev) {\n          return [].concat(_toConsumableArray(prev), [data === null || data === void 0 ? void 0 : data._id]);\n        });\n      }\n    });\n  }, [socket]);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [privateMessage && /*#__PURE__*/_jsx(PrivateChat, _objectSpread({}, {\n      selectedContact: selectedContact,\n      setPrivate: setPrivate,\n      messages: messages,\n      setMessages: setMessages,\n      socket: socket,\n      loading: loading\n    })), /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.root,\n      style: openChat ? {\n        bottom: 0\n      } : {\n        bottom: -372\n      },\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: styles.header,\n        onClick: function onClick() {\n          return setOpenChat(!openChat);\n        },\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          children: formatMessage(MessangerMessages.messaging)\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.spaceBetween,\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(SendSvg, {\n              className: styles.sendSvg\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: styles.toggle,\n            onClick: function onClick() {\n              return setOpenChat(!openChat);\n            },\n            children: openChat ? /*#__PURE__*/_jsx(ArrowDown, {}) : /*#__PURE__*/_jsx(ArrowUp, {})\n          })]\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: styles.body,\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: styles.search,\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: styles.messageSearch,\n            children: /*#__PURE__*/_jsx(GolTextField, {\n              className: styles.searchInput,\n              label: /*#__PURE__*/_jsxs(\"span\", {\n                className: styles.textFieldLabel,\n                children: [/*#__PURE__*/_jsx(SearchSvg, {}), /*#__PURE__*/_jsx(\"span\", {\n                  children: \"Search\"\n                })]\n              })\n            })\n          }), orders !== null && orders !== void 0 && orders.length ? /*#__PURE__*/_jsx(\"div\", {\n            className: styles.messages,\n            children: orders === null || orders === void 0 ? void 0 : orders.map(function (item) {\n              var _item$customer, _item$customer2, _item$customer3, _item$customer4, _item$customer5;\n\n              return /*#__PURE__*/_jsxs(\"div\", {\n                className: styles.message,\n                onClick: function onClick() {\n                  setSelectedContact(item);\n                  setPrivate(true);\n                  var newCounter = counter === null || counter === void 0 ? void 0 : counter.filter(function (el) {\n                    return el !== (item === null || item === void 0 ? void 0 : item._id);\n                  });\n                  setCounter(newCounter);\n                },\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: styles.flex,\n                  children: [/*#__PURE__*/_jsx(\"div\", {\n                    className: styles.avatar\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: styles.content,\n                    children: [/*#__PURE__*/_jsx(\"div\", {\n                      className: styles.name,\n                      children: \"\".concat(item !== null && item !== void 0 && (_item$customer = item.customer) !== null && _item$customer !== void 0 && _item$customer.firstName ? item === null || item === void 0 ? void 0 : (_item$customer2 = item.customer) === null || _item$customer2 === void 0 ? void 0 : _item$customer2.firstName : \"No Name\", \" \").concat(item !== null && item !== void 0 && (_item$customer3 = item.customer) !== null && _item$customer3 !== void 0 && _item$customer3.lastName ? item === null || item === void 0 ? void 0 : (_item$customer4 = item.customer) === null || _item$customer4 === void 0 ? void 0 : _item$customer4.lastName : \"\")\n                    }), /*#__PURE__*/_jsx(\"div\", {\n                      className: styles.text,\n                      children: item === null || item === void 0 ? void 0 : (_item$customer5 = item.customer) === null || _item$customer5 === void 0 ? void 0 : _item$customer5.email\n                    })]\n                  }), (selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id) !== (item === null || item === void 0 ? void 0 : item._id) && counter.includes(item === null || item === void 0 ? void 0 : item._id) && /*#__PURE__*/_jsx(\"div\", {\n                    className: styles.counter,\n                    children: counter === null || counter === void 0 ? void 0 : counter.filter(function (el) {\n                      return el === (item === null || item === void 0 ? void 0 : item._id);\n                    }).length\n                  })]\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: styles.date,\n                  children: new Date(item === null || item === void 0 ? void 0 : item.createdAt).toLocaleDateString()\n                })]\n              }, item === null || item === void 0 ? void 0 : item._id);\n            })\n          }) : \"No Orders\"]\n        })\n      })]\n    })]\n  });\n};\n\nexport default Messanger;","map":null,"metadata":{},"sourceType":"module"}